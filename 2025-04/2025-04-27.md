
## traitとは
traitとは、FactoryBotで複数のサンプルデータを作成する際に使われるテクニック。<br>
Factoryが複数ある場合、traitを使用することで記述の重複を減らすことができる。<br>

### (1.megabyte + 1) とは？
これはActiveSupport（Rails標準）で追加されてる便利メソッド。<br>

1.megabyte は実際には
```
1 * 1024 * 1024
= 1,048,576 バイト
// つまり1MBは1,048,576バイトなんだ。
```

2.megabyte + 1 だから、
```
1,048,577 バイト
```

### Tagのシーケンス
```
sequence(:name) { |n| "タグ#{n}" }
```
sequenceはFactoryBotの特別なメソッドで、一意の値を生成<br>
:nameはTagモデルの属性名（カラム名）<br>
{ |n| "タグ#{n}" }は、呼び出されるたびに増加する数値nを受け取り、「タグ1」「タグ2」などの文字列を生成します<br>



このファクトリを使うと、テストコード内で以下のように使えます：
```
# 1つのタグを作成
tag1 = create(:tag)  # => name が「タグ1」のTagオブジェクト

# 別のタグを作成
tag2 = create(:tag)  # => name が「タグ2」のTagオブジェクト

# さらに作成すると連番で増えていく
tag3 = create(:tag)  # => name が「タグ3」のTagオブジェクト
```


## `sequence(:name) { |n| "タグ#{n}" }` の理解度を測る問題をいくつか出します：

**問題1：基本的な理解**
次のファクトリ定義を使って3つのTagオブジェクトを順番に作成すると、それぞれの`name`属性はどのような値になりますか？

```ruby
FactoryBot.define do
  factory :tag do
    sequence(:name) { |n| "タグ#{n}" }
  end
end
```

**問題2：仕組みの理解**
以下のコードを実行した場合、変数`names`にはどのような値が入りますか？

```ruby
names = []
5.times do
  tag = create(:tag)
  names << tag.name
end
```

**問題3：応用**
次のように変更した場合、最初に作成されるTagオブジェクトの`name`属性はどうなりますか？

```ruby
FactoryBot.define do
  factory :tag do
    sequence(:name) { |n| "カテゴリー#{n + 10}" }
  end
end
```

**問題4：シーケンス応用**
以下のようなファクトリ定義があった場合、`create(:tag, name: "特別なタグ")`と実行すると、生成されるTagオブジェクトの`name`属性はどうなりますか？

```ruby
FactoryBot.define do
  factory :tag do
    sequence(:name) { |n| "タグ#{n}" }
  end
end
```

**問題5：複数のシーケンス**
以下のファクトリ定義がある場合、`create(:product)`を3回実行したときに作成される3つのProductオブジェクトの`name`属性と`code`属性は、それぞれどのような値になりますか？

```ruby
FactoryBot.define do
  factory :product do
    sequence(:name) { |n| "商品#{n}" }
    sequence(:code) { |n| "P-#{1000 + n}" }
  end
end
```


それでは、問題の解答と解説をします。

**問題1：基本的な理解**

**答え**：
1つ目: "タグ1"
2つ目: "タグ2"
3つ目: "タグ3"

**解説**：
`sequence`は呼び出されるたびに内部カウンタを1ずつ増やして、ブロックに渡します。最初の呼び出し時は`n=1`から始まり、その後`n=2`、`n=3`と続きます。

---

**問題2：仕組みの理解**

**答え**：
`names = ["タグ1", "タグ2", "タグ3", "タグ4", "タグ5"]`

**解説**：
5回ループで`create(:tag)`を実行するので、sequenceは1から始まり5まで順番に増えていきます。各回の`tag.name`が配列に追加されるため、結果として「タグ1」から「タグ5」の配列ができます。

---

**問題3：応用**

**答え**：
"カテゴリー11"

**解説**：
この定義では`n + 10`としているので、最初の呼び出し時は`n=1`が渡され、`1 + 10 = 11`となります。したがって最初のTagオブジェクトの`name`は「カテゴリー11」になります。

---

**問題4：シーケンス応用**

**答え**：
"特別なタグ"

**解説**：
`create(:tag, name: "特別なタグ")`では、明示的に`name`属性の値を指定しています。FactoryBotでは、明示的に指定された値がsequenceより優先されるため、結果として`name`は「特別なタグ」になります。シーケンスカウンタは増加しますが、その値は使われません。

---

**問題5：複数のシーケンス**

**答え**：
1つ目: name="商品1", code="P-1001"
2つ目: name="商品2", code="P-1002"
3つ目: name="商品3", code="P-1003"

**解説**：
複数のsequenceを定義することもできます。各属性のsequenceは独立して増加します。`name`は「商品1」から始まり、`code`は「P-1001」から始まります。3回`create(:product)`を実行すると、それぞれのカウンタが独立して増加していきます。


- FactoryBotでは、明示的に指定された値がsequenceより優先される
